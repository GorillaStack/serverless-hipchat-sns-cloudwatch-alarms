<!doctype html>
<html>
<head>
  <title>GorillaStack's HipChat SNS example</title>
  <link rel="stylesheet" href="//aui-cdn.atlassian.com/aui-hipchat/0.0.3/css/aui-hipchat.min.css">
  <!--jQuery (optional)-->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script type="text/javascript" src="//aui-cdn.atlassian.com/aui-hipchat/0.0.3/js/aui-hipchat.min.js"></script>
  <!--The cross domain messaging library, you need to import that to be able to use the HipChat Javascript API-->
  <script src="https://www.hipchat.com/atlassian-connect/all.js"></script>
  <!-- Reactjs shit -->
  <script src="https://npmcdn.com/react@15.3.0/dist/react.js"></script>
  <script src="https://npmcdn.com/react-dom@15.3.0/dist/react-dom.js"></script>
  <script src="https://npmcdn.com/babel-core@5.8.38/browser.min.js"></script>
</head>
<body>
  <div id="content"></div>
  <script type="text/babel" src="js/components.js"></script>

  <script type="text/javascript">
    $(document).ready(function () {
      $('#populateChatInput').click(function () {
        HipChat.chat.appendMessage('Hello world!');
      });

      $('#openDialog').click(function () {
        HipChat.dialog.open({
          key: 'sample.dialog'
        });
      });

      $('#sendCard').click(function (event) {
        event.preventDefault();
        //This will request a JWT token from the HipChat client, signed with the installation shared secret,
        //which you use to secure the REST call
        HipChat.auth.withToken(function (err, token) {
          //then, make a REST call to the add-on backend, including the JWT token
          $.ajax({
            type: 'POST',
            url: '${host}/post-card',
            headers: { authorization: 'JWT ' + token },
            data: JSON.stringify({ cardDescription: 'This card was posted from the Sidebar\nPretty cool hey!' }),
            crossDomain: true,
            contentType: 'application/json',
            dataType: 'json',
            error: function (response, jqXHR, status) {
              if (response.status !== 200) {
                alert('fail' + status.code);
              }
            }
          });
        });
      });

      $('#updateGlance').click(function (event) {
        event.preventDefault();
        HipChat.auth.withToken(function (err, token) {
          $.ajax({
            type: 'POST',
            url: '${host}/update-glance',
            headers: { authorization: 'JWT ' + token },
            data: JSON.stringify({ glanceText: 'Glance updated from Sidebar' }),
            crossDomain: true,
            contentType: 'application/json',
            dataType: 'json',
            error: function (response, jqXHR, status) {
              if (response.status !== 200) {
                alert('fail' + status.code);
              }
            }
          });
        });
      });

      //Handle the message action "sample-message-action" declared in the descriptor
      HipChat.register({
        'sample-message-action': function (message) {
          $('#msg').text(JSON.stringify(message));
        }
      });
    });
  </script>
</body>
</html>
